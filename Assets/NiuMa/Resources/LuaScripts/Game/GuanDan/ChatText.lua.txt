-- 描述：掼蛋聊天文本脚本
-- 作者：wujian
-- 邮箱：393817707@qq.com
-- 日期：2025.07.23

local base = require 'BehaviourBase';

local _module = setmetatable({}, { __index = base });

function _module:Awake()
	local obj = self.gameObject;
    local child = obj.transform:Find("Text");
    if (child ~= nil) then
        self._text = child.gameObject;
    end
    self._length = false;
end

function _module:Start()
end

function _module:Update()
    if ((self._text == nil) or self._length) then
            return;
    end
    --这里调用GetTextPreferredSize传递的0是没有意义的，但如果不传递C#会提示参数不为3个的错误
    local width, height = CS.NiuMa.LuaUGUI.GetTextPreferredSize(self._text, 0, 0);
    if (width < 58.0) then
        width = 58.0;
    elseif (width > 312.0) then
        width = 312.0;
    end
    if (height < 44.0) then
        height = 44.0;
    end
    width = width + 30.0;
    height = height + 20.0;
    local rcTrans = self.gameObject.transform;
    if (rcTrans ~= null) then
        rcTrans.sizeDelta = CS.UnityEngine.Vector2(width, height);
    end
    self._length = true;
end

function _module:Show(s)
    self.gameObject:SetActive(s);
end

function _module:SetChatText(text)
    if (self._text ~= nil) then
        self._length = false;
        CS.NiuMa.LuaUGUI.SetText(self._text, text);
    end
end

function _module.NewInstance()
    local t = setmetatable({}, { __index = _module });
    return t;
end

return _module;